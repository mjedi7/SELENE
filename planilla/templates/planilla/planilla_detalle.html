{% extends "planilla/menu.html" %}
{% load static %}
{% block content %}

<!-- Estilos de Datatables y Bootstrap -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<div class="container mt-4">
    <h2>Planilla de todos los Trabajadores</h2>
    <table id="planillaTable" class="display nowrap table table-striped" style="width:100%">
        <thead>
            <tr>
                <th>Datos</th>
                <th>Clave</th>
                <th>Nombre</th>
                <th>Departamento</th>
                <th>Puesto</th>
                <th>Inicio Laboral</th>
                <th>Sindicalizado</th>
                <th>Activo</th>
<!--                <th>Baja</th> -->
            </tr>
        </thead>
        <tbody>
            {% for t in trabajadores %}
            <tr>
                <td><button class="btn btn-primary btn-sm" onclick="verDetalle({{ t.clave }})">Datos</button></td>
                <td>{{ t.clave }}</td>
                <td>{{ t.nombre }}</td>
                <td>{{ t.departamento }}</td>
                <td>{{ t.puesto }}</td>
                <td>{{ t.fecha_inicio_rel_laboral }}</td>
                <td>{{ t.sindicalizado }}</td>
                <td>{{ t.activo }}</td>
<!--                <td>{{ t.baja }}</td> -->
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal de detalles estilo ficha -->
<div class="modal fade" id="detalleModal" tabindex="-1" aria-labelledby="detalleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detalleModalLabel">Detalle del Trabajador</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-6">
            <ul class="list-group" id="detalleColumnLeft"></ul>
          </div>
          <div class="col-6">
            <ul class="list-group" id="detalleColumnRight"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script para Datatables y modal -->
<script>
$(document).ready(function() {
    $('#planillaTable').DataTable({
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ],
        scrollX: true
    });
});


function verDetalle(pk) {
    $.get(`/planilla-detalle/${pk}/detalle/`, function(data){
        let leftHtml = '';
        let rightHtml = '';
        let i = 0;

        // Recorremos los campos y alternamos entre columnas
        for (const [key, value] of Object.entries(data)) {
            const item = `<li class="list-group-item"><strong>${key.replace(/_/g,' ').toUpperCase()}:</strong> ${value || ''}</li>`;
            if (i % 2 === 0) {
                leftHtml += item;
            } else {
                rightHtml += item;
            }
            i++;
        }

        $('#detalleColumnLeft').html(leftHtml);
        $('#detalleColumnRight').html(rightHtml);

        // Abrimos modal
        var myModal = new bootstrap.Modal(document.getElementById('detalleModal'));
        myModal.show();
    });
}
</script>

{% endblock %}